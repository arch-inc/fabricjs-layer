(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[278],{3349:function(e,t,r){!function(e,t){"use strict";var r=function(){function e(e){this.canvas=e,this.type="Layer",this.createdTime=Date.now(),this.startIndex=this.endIndex=e._objects.length,this._listeners=[]}return e.prototype.addListener=function(e){this._listeners.indexOf(e)>=0||this._listeners.push(e)},e.prototype.removeListener=function(e){var t=this._listeners.indexOf(e);return!(t<0)&&(this._listeners.splice(t,1),!0)},e.prototype.fire=function(e){this._listeners.forEach((function(t){switch(e.type){case"object:add":t.onObjectAdd&&t.onObjectAdd(e);break;case"object:remove":t.onObjectRemove&&t.onObjectRemove(e)}}))},e}();function n(e,t){for(var r=0,n=t.length,s=e.length;r<n;r++,s++)e[s]=t[r];return e}function s(e,t){var r=t.length-1;return t[r]===e?r:t.indexOf(e)}var i=function(){function e(e){this.canvas=e,this._activeLayer=new r(e),this._activeLayerIndex=0,this._layers=[this._activeLayer],this._listeners=[],this.onObjectAdd=this.onObjectAdd.bind(this),this.onObjectRemove=this.onObjectRemove.bind(this),e.on("object:added",this.onObjectAdd),e.on("object:removed",this.onObjectRemove)}return Object.defineProperty(e.prototype,"activeLayer",{get:function(){return this._activeLayer},set:function(e){var t=s(e,this._layers);if(t<0)throw new Error("Layer not found or managed");this.activeLayerIndex=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activeLayerIndex",{get:function(){return this._activeLayerIndex},set:function(e){if(e<0||e>=this._layers.length)throw new Error("Layer index out of bounds");this._activeLayerIndex!==e&&(this._activeLayerIndex=e,this._activeLayer=this._layers[e],this.fire({type:"layer:activate",layer:this._layers[e]}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layers",{get:function(){return this._layers.slice()},set:function(e){throw new Error("Layers property cannot be set directly.")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layersLength",{get:function(){return this._layers.length},enumerable:!1,configurable:!0}),e.prototype.findLayer=function(e){var r=this.canvas._objects.indexOf(e);if(r<0)throw new Error("Object not found");var n=t.sortedIndex(this._layers,{endIndex:r},(function(e){return e.endIndex}));return this._layers[n]},e.prototype.getLayer=function(e){if(e<0||e>this._layers.length)throw new Error("Layer index out of bounds");return this._layers[e]},e.prototype.getLayerIndex=function(e){return this._layers.indexOf(e)},e.prototype.addLayer=function(e){if("number"==typeof e){if(e<0||e>this._layers.length)throw new Error("Layer index out of bounds")}else e=this._layers.length;var t=new r(this.canvas);return e>0&&(e>=this._layers.length?t.startIndex=this._layers[this._layers.length-1].endIndex:t.startIndex=this._layers[e].startIndex),t.endIndex=t.startIndex,this._layers.splice(e,0,t),this.fire({type:"layer:add",layer:t}),t},e.prototype.removeLayer=function(e){var t=this.getLayerIndex(e);return!(t<0)&&(this.removeLayerByIndex(t),!0)},e.prototype.removeLayerByIndex=function(e){var t=this,r=this.getLayer(e);this._layers.splice(e,1);var n=r.endIndex-r.startIndex;this.canvas._objects.splice(r.startIndex,n).forEach((function(e){return t.canvas._onObjectRemoved(e)}),this),this.canvas.renderOnAddRemove&&this.canvas.requestRenderAll();for(var s=e;s<this._layers.length;s++)this._layers[s].startIndex-=n,this._layers[s].endIndex-=n;e>0?this.activeLayerIndex=e-1:(this._layers.length<=0&&this.addLayer(0),this.activeLayerIndex=0),this.fire({type:"layer:remove",layer:r})},e.prototype.moveLayer=function(e,t){var r,s,i=this.getLayer(e);this._layers.splice(e,1);var a,o=i.endIndex-i.startIndex,h=this.canvas._objects.splice(i.startIndex,o);if(t<e){a=this.getLayer(t).startIndex,(r=this.canvas._objects).splice.apply(r,n([a,0],h));for(var c=t;c<e;c++)this._layers[c].startIndex+=o,this._layers[c].endIndex+=o}else for(a=this.getLayer(t-1).endIndex-o,(s=this.canvas._objects).splice.apply(s,n([a,0],h)),c=e;c<t;c++)this._layers[c].startIndex-=o,this._layers[c].endIndex-=o;i.startIndex=a,i.endIndex=a+o,this._layers.splice(t,0,i),this.canvas.renderOnAddRemove&&this.canvas.requestRenderAll(),this.fire({type:"layer:move",layer:i,options:{from:e,to:t}}),this.activeLayerIndex=t},e.prototype.onObjectAdd=function(e){var t=s(e.target,this.canvas._objects);t<this._activeLayer.startIndex||t>this._activeLayer.endIndex+1?(this.canvas._objects.splice(t,1),this.canvas._objects.splice(this._activeLayer.endIndex,0,e.target),this.canvas.renderOnAddRemove&&this.canvas.requestRenderAll()):this._activeLayer.endIndex++;for(var r=this.activeLayerIndex+1;r<this._layers.length;r++)this._layers[r].startIndex++,this._layers[r].endIndex++;var n={type:"object:add",event:e};this._activeLayer.fire(n),console.log("added",e.target,"to",this._activeLayer)},e.prototype.onObjectRemove=function(e){var t=e.target;console.log("removed",t)},e.prototype.addListener=function(e){this._listeners.indexOf(e)>=0||this._listeners.push(e)},e.prototype.removeListener=function(e){var t=this._listeners.indexOf(e);return!(t<0)&&(this._listeners.splice(t,1),!0)},e.prototype.fire=function(e){this._listeners.forEach((function(t){switch(e.type){case"layer:activate":t.onLayerActivated&&t.onLayerActivated(e);break;case"layer:deactivate":t.onLayerDeactivated&&t.onLayerDeactivated(e);break;case"layer:add":t.onLayerAdd&&t.onLayerAdd(e);break;case"layer:remove":t.onLayerRemove&&t.onLayerRemove(e);break;case"layer:move":t.onLayerMove&&t.onLayerMove(e)}}))},e.prototype.dispose=function(){this.canvas.off("object:added",this.onObjectAdd),this.canvas.off("object:removed",this.onObjectRemove),this.canvas=null},e}();e.LayerGroup=r,e.LayerManager=i,e.getIndexOf=s,Object.defineProperty(e,"__esModule",{value:!0})}(t,r(6653))},7515:function(e,t,r){"use strict";r.r(t),r.d(t,{App:function(){return c}});var n=r(6772),s=r(7988),i=r(1717),a=r(9508),o=r(8441),h=r(3349),c=function(){function e(t){(0,n.Z)(this,e),this.el=t,(0,i.Z)(this,"canvas",void 0),(0,i.Z)(this,"brush",void 0),(0,i.Z)(this,"manager",void 0),(0,i.Z)(this,"_erasing",void 0),(0,i.Z)(this,"_brushColor",void 0),this.initialize()}return(0,s.Z)(e,[{key:"erasing",get:function(){return this._erasing},set:function(e){this._erasing=e,this.brush&&(this.brush.color=e?"#c00":this.brushColor)}},{key:"brushColor",get:function(){return this._brushColor||"#000"},set:function(e){this._brushColor=e,this.brush&&(this.brush.color=e)}},{key:"layerManager",get:function(){return this.manager}},{key:"initialized",get:function(){return this.canvas&&this.brush&&this.manager}},{key:"initialize",value:function(){var e=this;if(!this.el.parentElement)throw new Error("Canvas element is not attached to the DOM tree");this.el.width=Math.min(640,this.el.width),this.el.height=this.el.width;var t=new a.fabric.Canvas(this.el,{isDrawingMode:!0,enablePointerEvents:!0});this.brush=new o.PSBrush(t),this.brush.width=10,this.brush.color="#000",t.freeDrawingBrush=this.brush,t.on("object:added",(function(t){var r=t.target;if(r instanceof o.PSStroke&&e.erasing){var n=r;n.globalCompositeOperation="destination-out",n.stroke="#000",n.selectable=!1,n.evented=!1}})),this.canvas=t,this.manager=new h.LayerManager(t)}},{key:"dispose",value:function(){this.canvas&&(this.manager.dispose(),this.manager=null,this.canvas.dispose(),this.canvas=null,this.brush=null,console.log("disposed"))}}]),e}()},3733:function(){},7123:function(){},6767:function(){}}]);